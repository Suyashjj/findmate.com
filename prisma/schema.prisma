generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  clerkId   String   @unique
  
  // Slide 1 - Basic Info
  name      String
  email     String   @unique
  phone     String?
  age       Int?
  gender    String?
  profilePhoto String?
  
  // Slide 2 - Location & Preferences
  city           String?
  state          String?
  budgetMin      Int?
  budgetMax      Int?
  foodPreference String?
  smoking        Boolean  @default(false)
  drinking       Boolean  @default(false)
  interests      String[]
  about          String?    @db.Text
  
  // Slide 3 - Links & Documents
  socialLinks String[]
  documents   String[]
  
  // Premium/Subscription (NEW)
  isPremium        Boolean   @default(false)
  premiumExpiry    DateTime?
  subscriptionPlan String?   // "6_months" or "1_year"
  
  // Relations
  posts            Post[]
  payments         Payment[]
  sentRequests     ConnectionRequest[] @relation("RequestSender")
  receivedRequests ConnectionRequest[] @relation("RequestReceiver")
  
  // Meta
  profileCompleted Boolean @default(false)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  @@map("users")
}

model Post {
  id     String @id @default(cuid())
  
  // Relation field
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Copied profile fields
  name      String
  age       Int
  gender    String
  phone     String?
  city      String
  state     String
  budgetMin Int
  budgetMax Int
  foodPreference String?
  smoking   Boolean @default(false)
  drinking  Boolean @default(false)
  interests String[]
  profilePhoto String?
  
  // Post-specific
  currentAddress    String
  additionalDetails String @db.Text
  
  // Premium
  socialLinks String[]
  documents   String[]
  
  // Relations (NEW)
  requests  ConnectionRequest[]
  
  // Meta
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("posts")
}

model Payment {
  id        String   @id @default(cuid())
  
  // User relation
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Payment details
  amount           Int      // 399 or 599
  currency         String   @default("INR")
  plan             String   // "6_months" or "1_year"
  
  // Razorpay details
  razorpayOrderId   String?  @unique
  razorpayPaymentId String?  @unique
  razorpaySignature String?
  
  // Status
  status           String   @default("pending") // pending, success, failed
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("payments")
}

model ConnectionRequest {
  id        String   @id @default(cuid())
  
  // Sender (person sending request)
  senderId  String
  sender    User     @relation("RequestSender", fields: [senderId], references: [id], onDelete: Cascade)
  
  // Receiver (post owner)
  receiverId String
  receiver   User    @relation("RequestReceiver", fields: [receiverId], references: [id], onDelete: Cascade)
  
  // Related post
  postId    String
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  
  // Status
  status    String   @default("pending") // pending, accepted, rejected
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([senderId, postId]) // User can only send one request per post
  @@map("connection_requests")
}